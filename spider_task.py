import asyncio
import uuid
from datetime import datetime

import requests
import configparser

from CosService import CosService
from util import logging_config


class SpiderTask:

    def __init__(self, env):
        self.logging = logging_config.setup_logger('log/spider.log', self.__class__.__name__)
        # self.tasks = asyncio.Queue(maxsize=20)
        cos_config = configparser.ConfigParser()
        cos_config.read(f'config/{env}/config-oss.ini')
        self.o = CosService(cos_config)
        self.bucket_name = cos_config.get('connection','bucket_name')
        self.bucket_url = cos_config.get('connection','bucket_url')


    async def task_producer(self, query_api: str, model_id: int, tasks: asyncio.Queue) -> None:
        while True:
            now = datetime.now().strftime('%Y-%m-%d')
            # res = requests.get(query_api.format(date=now,model_type=model_id))
            # json_data = res.json()
            json_data = {'msg': '查询成功', 'code': 200, 'data': {'taskList': [{'taskDetailId': 85, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '1', 'dailyRunCount': 5}, {'taskDetailId': 86, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 03:36:00', 'targetLargeModel': '1', 'dailyRunCount': 5}, {'taskDetailId': 87, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 07:12:00', 'targetLargeModel': '1', 'dailyRunCount': 5}, {'taskDetailId': 88, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 10:48:00', 'targetLargeModel': '1', 'dailyRunCount': 5}, {'taskDetailId': 89, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 14:24:00', 'targetLargeModel': '1', 'dailyRunCount': 5}, {'taskDetailId': 90, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '2', 'dailyRunCount': 5}, {'taskDetailId': 91, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 03:36:00', 'targetLargeModel': '2', 'dailyRunCount': 5}, {'taskDetailId': 92, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 07:12:00', 'targetLargeModel': '2', 'dailyRunCount': 5}, {'taskDetailId': 93, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 10:48:00', 'targetLargeModel': '2', 'dailyRunCount': 5}, {'taskDetailId': 94, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 14:24:00', 'targetLargeModel': '2', 'dailyRunCount': 5}, {'taskDetailId': 95, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '3', 'dailyRunCount': 5}, {'taskDetailId': 96, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 03:36:00', 'targetLargeModel': '3', 'dailyRunCount': 5}, {'taskDetailId': 97, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 07:12:00', 'targetLargeModel': '3', 'dailyRunCount': 5}, {'taskDetailId': 98, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 10:48:00', 'targetLargeModel': '3', 'dailyRunCount': 5}, {'taskDetailId': 99, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 14:24:00', 'targetLargeModel': '3', 'dailyRunCount': 5}, {'taskDetailId': 100, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '4', 'dailyRunCount': 5}, {'taskDetailId': 101, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 03:36:00', 'targetLargeModel': '4', 'dailyRunCount': 5}, {'taskDetailId': 102, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 07:12:00', 'targetLargeModel': '4', 'dailyRunCount': 5}, {'taskDetailId': 103, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 10:48:00', 'targetLargeModel': '4', 'dailyRunCount': 5}, {'taskDetailId': 104, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 14:24:00', 'targetLargeModel': '4', 'dailyRunCount': 5}, {'taskDetailId': 105, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '5', 'dailyRunCount': 5}, {'taskDetailId': 106, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 03:36:00', 'targetLargeModel': '5', 'dailyRunCount': 5}, {'taskDetailId': 107, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 07:12:00', 'targetLargeModel': '5', 'dailyRunCount': 5}, {'taskDetailId': 108, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 10:48:00', 'targetLargeModel': '5', 'dailyRunCount': 5}, {'taskDetailId': 109, 'taskName': '智己汽车', 'question': '智己 LS6 和智己 LS9 怎么选？家用大五座和大六座哪个更合适？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 14:24:00', 'targetLargeModel': '5', 'dailyRunCount': 5}, {'taskDetailId': 110, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '1', 'dailyRunCount': 5}, {'taskDetailId': 111, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 03:36:00', 'targetLargeModel': '1', 'dailyRunCount': 5}, {'taskDetailId': 112, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 07:12:00', 'targetLargeModel': '1', 'dailyRunCount': 5}, {'taskDetailId': 113, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 10:48:00', 'targetLargeModel': '1', 'dailyRunCount': 5}, {'taskDetailId': 114, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 14:24:00', 'targetLargeModel': '1', 'dailyRunCount': 5}, {'taskDetailId': 115, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '2', 'dailyRunCount': 5}, {'taskDetailId': 116, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 03:36:00', 'targetLargeModel': '2', 'dailyRunCount': 5}, {'taskDetailId': 117, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 07:12:00', 'targetLargeModel': '2', 'dailyRunCount': 5}, {'taskDetailId': 118, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 10:48:00', 'targetLargeModel': '2', 'dailyRunCount': 5}, {'taskDetailId': 119, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 14:24:00', 'targetLargeModel': '2', 'dailyRunCount': 5}, {'taskDetailId': 120, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '3', 'dailyRunCount': 5}, {'taskDetailId': 121, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 03:36:00', 'targetLargeModel': '3', 'dailyRunCount': 5}, {'taskDetailId': 122, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 07:12:00', 'targetLargeModel': '3', 'dailyRunCount': 5}, {'taskDetailId': 123, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 10:48:00', 'targetLargeModel': '3', 'dailyRunCount': 5}, {'taskDetailId': 124, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 14:24:00', 'targetLargeModel': '3', 'dailyRunCount': 5}, {'taskDetailId': 125, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '4', 'dailyRunCount': 5}, {'taskDetailId': 126, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 03:36:00', 'targetLargeModel': '4', 'dailyRunCount': 5}, {'taskDetailId': 127, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 07:12:00', 'targetLargeModel': '4', 'dailyRunCount': 5}, {'taskDetailId': 128, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 10:48:00', 'targetLargeModel': '4', 'dailyRunCount': 5}, {'taskDetailId': 129, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 14:24:00', 'targetLargeModel': '4', 'dailyRunCount': 5}, {'taskDetailId': 130, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '5', 'dailyRunCount': 5}, {'taskDetailId': 131, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 03:36:00', 'targetLargeModel': '5', 'dailyRunCount': 5}, {'taskDetailId': 132, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 07:12:00', 'targetLargeModel': '5', 'dailyRunCount': 5}, {'taskDetailId': 133, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 10:48:00', 'targetLargeModel': '5', 'dailyRunCount': 5}, {'taskDetailId': 134, 'taskName': '智己汽车', 'question': '智己 L6 和同级新能源轿车相比，核心优势是什么？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 14:24:00', 'targetLargeModel': '5', 'dailyRunCount': 5}, {'taskDetailId': 135, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '1', 'dailyRunCount': 5}, {'taskDetailId': 136, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 03:36:00', 'targetLargeModel': '1', 'dailyRunCount': 5}, {'taskDetailId': 137, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 07:12:00', 'targetLargeModel': '1', 'dailyRunCount': 5}, {'taskDetailId': 138, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 10:48:00', 'targetLargeModel': '1', 'dailyRunCount': 5}, {'taskDetailId': 139, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 14:24:00', 'targetLargeModel': '1', 'dailyRunCount': 5}, {'taskDetailId': 140, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '2', 'dailyRunCount': 5}, {'taskDetailId': 141, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 03:36:00', 'targetLargeModel': '2', 'dailyRunCount': 5}, {'taskDetailId': 142, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 07:12:00', 'targetLargeModel': '2', 'dailyRunCount': 5}, {'taskDetailId': 143, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 10:48:00', 'targetLargeModel': '2', 'dailyRunCount': 5}, {'taskDetailId': 144, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 14:24:00', 'targetLargeModel': '2', 'dailyRunCount': 5}, {'taskDetailId': 145, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '3', 'dailyRunCount': 5}, {'taskDetailId': 146, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 03:36:00', 'targetLargeModel': '3', 'dailyRunCount': 5}, {'taskDetailId': 147, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 07:12:00', 'targetLargeModel': '3', 'dailyRunCount': 5}, {'taskDetailId': 148, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 10:48:00', 'targetLargeModel': '3', 'dailyRunCount': 5}, {'taskDetailId': 149, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 14:24:00', 'targetLargeModel': '3', 'dailyRunCount': 5}, {'taskDetailId': 150, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '4', 'dailyRunCount': 5}, {'taskDetailId': 151, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 03:36:00', 'targetLargeModel': '4', 'dailyRunCount': 5}, {'taskDetailId': 152, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 07:12:00', 'targetLargeModel': '4', 'dailyRunCount': 5}, {'taskDetailId': 153, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 10:48:00', 'targetLargeModel': '4', 'dailyRunCount': 5}, {'taskDetailId': 154, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 14:24:00', 'targetLargeModel': '4', 'dailyRunCount': 5}, {'taskDetailId': 155, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '5', 'dailyRunCount': 5}, {'taskDetailId': 156, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 03:36:00', 'targetLargeModel': '5', 'dailyRunCount': 5}, {'taskDetailId': 157, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 07:12:00', 'targetLargeModel': '5', 'dailyRunCount': 5}, {'taskDetailId': 158, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 10:48:00', 'targetLargeModel': '5', 'dailyRunCount': 5}, {'taskDetailId': 159, 'taskName': '智己汽车', 'question': '智己 LS8 的定位和竞品（问界 M7、理想 L8）有哪些差异？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 14:24:00', 'targetLargeModel': '5', 'dailyRunCount': 5}, {'taskDetailId': 160, 'taskName': '智己监控', 'question': '智己的灵蜥数字底盘 3.0 是什么？四轮转向功能实际体验如何？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '1', 'dailyRunCount': 3}, {'taskDetailId': 161, 'taskName': '智己监控', 'question': '智己的灵蜥数字底盘 3.0 是什么？四轮转向功能实际体验如何？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 06:00:00', 'targetLargeModel': '1', 'dailyRunCount': 3}, {'taskDetailId': 162, 'taskName': '智己监控', 'question': '智己的灵蜥数字底盘 3.0 是什么？四轮转向功能实际体验如何？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 12:00:00', 'targetLargeModel': '1', 'dailyRunCount': 3}, {'taskDetailId': 163, 'taskName': '智己监控', 'question': '智己的灵蜥数字底盘 3.0 是什么？四轮转向功能实际体验如何？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '3', 'dailyRunCount': 3}, {'taskDetailId': 164, 'taskName': '智己监控', 'question': '智己的灵蜥数字底盘 3.0 是什么？四轮转向功能实际体验如何？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 06:00:00', 'targetLargeModel': '3', 'dailyRunCount': 3}, {'taskDetailId': 165, 'taskName': '智己监控', 'question': '智己的灵蜥数字底盘 3.0 是什么？四轮转向功能实际体验如何？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 12:00:00', 'targetLargeModel': '3', 'dailyRunCount': 3}, {'taskDetailId': 166, 'taskName': '智己监控', 'question': '智己 IM AD 无图城市 NOA 的覆盖范围和实际使用效果怎么样？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '1', 'dailyRunCount': 3}, {'taskDetailId': 167, 'taskName': '智己监控', 'question': '智己 IM AD 无图城市 NOA 的覆盖范围和实际使用效果怎么样？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 06:00:00', 'targetLargeModel': '1', 'dailyRunCount': 3}, {'taskDetailId': 168, 'taskName': '智己监控', 'question': '智己 IM AD 无图城市 NOA 的覆盖范围和实际使用效果怎么样？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 12:00:00', 'targetLargeModel': '1', 'dailyRunCount': 3}, {'taskDetailId': 169, 'taskName': '智己监控', 'question': '智己 IM AD 无图城市 NOA 的覆盖范围和实际使用效果怎么样？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 00:00:00', 'targetLargeModel': '3', 'dailyRunCount': 3}, {'taskDetailId': 170, 'taskName': '智己监控', 'question': '智己 IM AD 无图城市 NOA 的覆盖范围和实际使用效果怎么样？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 06:00:00', 'targetLargeModel': '3', 'dailyRunCount': 3}, {'taskDetailId': 171, 'taskName': '智己监控', 'question': '智己 IM AD 无图城市 NOA 的覆盖范围和实际使用效果怎么样？', 'keyWord': '智己', 'earlyQuestionTime': '2025-12-09 12:00:00', 'targetLargeModel': '3', 'dailyRunCount': 3}], 'lastTaskId': 171, 'hasNext': False}}
            self.logging.info(json_data)
            task_list = json_data['data']['taskList']

            if not task_list:
                await asyncio.sleep(60 * 60)
            else:
                for task in task_list:
                    t = {'question': task['question'],
                         'task_id': task['taskDetailId']}
                    self.logging.info(t)
                    await tasks.put(t)

    async def task_consumer(self, update_api: str, spider, q: asyncio.Queue) -> None:
        while True:
            try:
                task = await q.get()
                question = task['question']
                task_id = task['task_id']

                try:
                    data_json = await spider.run_once(question)
                    data_json['taskid'] = task_id
                    if 'screenshot' in data_json:
                        key = "{}/{}.{}".format(spider.__class__.__name__.lower(), uuid.uuid1(), 'png')
                        self.o.upload_file_to_oss(data_json['screenshot'], self.bucket_name, key)
                        cos_url = self.bucket_url + key
                        data_json['cos_url'] = cos_url


                    self.logging.info(data_json)
                except Exception as e:
                    data_json = {'runStatus': 0, 'taskid': task_id}
                    self.logging.error(e)

                res = requests.post(update_api,json=data_json)
                print(res.content)
                self.logging.info(res.content)
            except Exception as e:
                self.logging.error(e)

